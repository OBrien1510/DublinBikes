{% extends 'layout.html' %}

{% block head %}

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    
    <script type=text/javascript>
  		$SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
  		
  		function mapInit() {
			var mapCenter = {lat: 53.3498, lng: -6.2603};
    		var map = new google.maps.Map(document.getElementById('googleMap'), {
        	zoom: 14, 
        	center: mapCenter});
  		
  				$.getJSON($SCRIPT_ROOT + '/_map_data', function(data) {
      		
      				// Create empty array 'index'
					var index = [];
					// Add (i.e. 'push') the next xID item to the array
      				for(var xID in data) {
      					index.push(xID);		
      				}
      			
      			// Fill map up with markers based on json data
        		// Right now all markers are being generated, but they are being given all the same
        		// content, when they should be given content depending on their own personal info.
				for(i = 0; i < index.length; i++) {
    				var mytext = index[i] + "<br> Station No.: " + "<br> Free bikes: ";
    				var myinfowindow = new google.maps.InfoWindow({content: mytext});
             
					var position = new google.maps.LatLng(data[index[i]].latitude, data[index[i]].longitude);
        			var contentString = '<div>' +
        								'<h2>' + index[i] + '</h2>' +
        								'<p>Available Bikes: ' + data[index[i]].available_bikes + '</p>' +
        								'<p>Available Bike Stands: ' + data[index[i]].available_stands + '</p>' +
        								'</div>';
        			
        			var myinfowindow = new google.maps.InfoWindow({content: contentString});
        			
    				var marker = new google.maps.Marker({
    					position: position, 
    					map: map,
    					infowindow: myinfowindow
    				});
    				
    				google.maps.event.addListener(marker, 'click', function() {
        				this.infowindow.open(map, this);

					});
    				
    			}
				
			});

      	}
	</script>
    
{% endblock %}    
    
{% block body %}

	<div id="googleMap" style="width:100%;height:600px;margin-left:0;margin-right:0"></div>

	<!--<script src="{{ url_for('static', filename='javascriptNew.js') }}"></script>-->
	<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA55VhjQyX8BeKEq7Przs3q7NU9RBLNBRg&callback=mapInit"></script>

{% endblock %}
